name: Windows-AnyDesk

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest
    timeout-minutes: 360

    steps:
    - name: Download AnyDesk
      run: |
        Invoke-WebRequest -Uri "https://download.anydesk.com/AnyDesk.exe" -OutFile "AnyDesk.exe"

    - name: Install and Setup AnyDesk
      run: |
        Start-Process .\AnyDesk.exe -ArgumentList "--install C:\AnyDesk --start-with-win --silent" -Wait
        Start-Sleep -Seconds 15
        
        # Get AnyDesk ID
        $adPath = "C:\Program Files (x86)\AnyDesk\AnyDesk.exe"
        if(!(Test-Path $adPath)) { $adPath = "C:\AnyDesk\AnyDesk.exe" }
        
        # Set password via command line
        & $adPath --set-password MyPass123!

    - name: Get AnyDesk ID
      run: |
        Start-Sleep -Seconds 10
        $adPath = "C:\Program Files (x86)\AnyDesk\AnyDesk.exe"
        if(!(Test-Path $adPath)) { $adPath = "C:\AnyDesk\AnyDesk.exe" }
        
        if(Test-Path $adPath) {
          $id = & $adPath --get-id
          Write-Host ""
          Write-Host "================================================"
          Write-Host "ANYDESK ID: $id" -ForegroundColor Green
          Write-Host "PASSWORD: MyPass123!" -ForegroundColor Green
          Write-Host "================================================"
          Write-Host ""
          Write-Host "Download AnyDesk on your phone and connect!"
        } else {
          Write-Host "AnyDesk not found!"
        }

    - name: Keep Alive
      run: |
        Write-Host "AnyDesk is running. Keep this workflow open."
        while($true) { 
          Start-Sleep 600
          Write-Host "Still running..."
        }
